<!--+ Warning: Content inside HTML comment blocks was generated by mdat and may be overwritten. +-->

<!-- title -->

# yanki-md

<!-- /title -->

<!-- badges -->

[![NPM Package yanki-md](https://img.shields.io/npm/v/yanki-md.svg)](https://npmjs.com/package/yanki-md)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

<!-- /badges -->

<!-- short-description -->

**An ultra-simple CLI tool and TypeScript library for syncing Markdown to Anki flashcards. No customization. No configuration. No fuss.**

<!-- /short-description -->

## Overview

Yanki MD simply syncs a folder of Markdown notes to Anki.

The "Y" prefix in "Yanki" is in the "Yet another" naming tradition; a nod to Anki's robust and occasionally duplicative ecosystem of third-party tools.

## Quick start

Assuming you have a folder of Markdown note files, the [Anki app](https://apps.ankiweb.net) is open and has the the [Anki-Connect](https://foosoft.net/projects/anki-connect/) add-on installed:

```sh
npx yanki ./folder-of-markdown
```

This will turn the folder's Markdown files into Anki notes and send them up to the Anki database.

## Features

### One Markdown file = one Anki note

Avoid the complexity of mixing and matching multi-note and single-note syntaxes. One local Markdown file always yields one Anki note.

### Folder hierarchy = Anki deck hierarchy

Yanki MD uses the source Markdown file's parent directory name as the deck name. Complex folder hierarchies are also supported — Anki decks will be created and nested as needed to match the structure of the local file system.

### Leverage the default Anki note types

Yanki _only_ supports turning Markdown into the "Basic", "Basic (and reversed card)" , "Basic (type in the answer)", and "Cloze" note types that ship as defaults in the Anki App.

### Anki note type is inferred from Markdown structure

Since the number of supported note types is small, the type of Anki note to create from a given document can be inferred from a few simple rules about the structure of the Markdown.

For example, a Basic note is any Markdown file with a `---` horizontal rule splitting the front and back of the card:

```md
I'm the front.

---

I'm the back.
```

That's it, no extra metadata or Anki-specific markup is required. You can add whatever additional Markdown syntax you'd like to style the note.

The structural cues for all four supported note types are described [later in this document](#markdown-note-types).

### Tags in frontmatter

Optionally, you can add a `tags` array to your Markdown file's frontmatter and have it automatically synchronized to the Anki database. Frontmatter is also used to store the Anki note's ID after an initial synchronization.

### Intelligent synchronization

Your local Markdown files are the single point of truth for what will and up in Anki, but Yanki MD knows to leave your other Anki notes alone.

When you edit a local markdown note, Yanki MD makes every effort to update rather than delete it in the Anki database so that progress is preserved.

But when you do want to delete something, it's as simple as deleting the local Markdown note from the file system and running `yanki sync` to remove it from the Anki database. Protections are in place to prevent deleting Anki notes that weren't initially created by Yanki MD.

### Fancy markdown

An extended palette of markdown syntax is available out of the box:

- [GitHub Flavored Markdown](https://github.github.com/gfm/), including `| tables |`, `~~strike-throughs~~`, `- [x] task lists`, and autolinks.
- Syntax highlighting via [Shiki](https://shiki.style).
- GitHub-style [Alerts](https://docs.github.com/en/get-started/writing-on-github/getting-started-with-writing-and-formatting-on-github/basic-writing-and-formatting-syntax#alerts).
- [WikiLinks](https://github.com/Python-Markdown/markdown/blob/master/docs/extensions/wikilinks.md)
- [LaTeX formatted mathematical expressions](https://docs.github.com/en/get-started/writing-on-github/working-with-advanced-formatting/writing-mathematical-expressions) via [MathJax](https://www.mathjax.org)
- Support for the [`==highlights==`](https://github.com/ipikuka/remark-flexible-markers) syntax.

## Markdown note types

Yanki MD automatically infers the _type_ of Note you'd like to create in Anki based on the presence or absence of certain element in your Markdown files.

The rules were designed with the semantic and visual nature of Markdown in mind.

The most minimal examples to "trigger" different note types are shown below, but the implementation can handle additional weirdness and will generally do the right thing if it encounters elements that might indicate conflicting note types.

You're free to use additional Markdown in your note files to style and structure the front and back of your flashcards. Image markup will work, but currently assets must be hosted externally and are not copied into Anki's media storage system.

### Basic

A basic card is created from any file with a `---`:

```md
This is the front of the card

---

This is the back of the card
```

### Basic (and reversed card)

Doubling up the `---` identifies the note as being reversible (and will result in the generation of two cards in Anki).

_Mnemonic: Twice the `---` for twice the cards._

```md
Sometimes the answer is the question

---

---

Sometimes the question is the answer
```

<em>Mnemonic: The syntax resembles a `_blank to be filled in_`.</em>

### Basic (type in the answer)

If the last statement in the Markdown file is `_emphasized like this_`, it becomes the type-in-the-answer text in Anki.

```md
Jazz isn't dead

_It just smells funny_
```

---

### Cloze

Text that is `~~struck through~~` with the [somewhat esoteric double-tilde syntax](https://github.github.com/gfm/#strikethrough-extension-) will be hidden in the resulting cloze Note:

_Mnemonic: The `~~strike through~~` implies redaction._

```md
All will be ~~revealed~~.
```

Multiple clozes are supported, which will create additional cards. You can add a `---` to include back-of-card information as well. Hints are also supported, and are indicated by giving the hint text `_emphasis_` at the end of the cloze strike-through:

```md
~~All~~ will be ~~revealed _here's a hint: "shown"_~~.

---

Additional revelations on the back of the card.
```

Clozing a block element is not currently supported.

## Getting started

> \[!WARNING]
> Yanki MD is still in develop. Please back up your Anki library if you intend to use it, and please expect changes to commands and the exported APIs until the 1.0.0 release.

### Dependencies

The `yanki` CLI tool requires Node 18+. The exported TypeScript / JavaScript APIs are ESM-only and share the Node 18+ requirement. Yanki MD is implemented in TypeScript and bundles a complete set of type definitions.

The [Anki](https://apps.ankiweb.net) desktop app with the [Anki-Connect](https://foosoft.net/projects/anki-connect/) add-on installed and configured is also required to do anything useful with the library.

### Installation

Invoke directly:

```sh
npx yanki-md ./folder-to-sync/**/*.md
```

...or install globally:

```sh
npm install --global yanki-md
```

...or install locally in your JavaScript or TypeScript project to use the exported APIs:

```sh
npm install --save-dev yanki-md
```

## Usage

### Basic

#### Setup

Create a folder of Markdown files that you'd like to use as Anki notes. (See the [section on Markdown notes](#markdown-note-types) for details on how to structure your document to create different card types in Anki.)

Launch the Anki desktop app. Ensure that the [Anki-Connect](https://foosoft.net/projects/anki-connect/) add-on is installed and set up.

#### Create

Pass the path to a folder of Markdown notes to turn them into Anki notes and send them to the Anki database:

```sh
yanki ./your-deck-folder
```

You'll now see your Markdown files as HTML-rendered notes in the Anki desktop app.

#### Update

Edit the Markdown file locally (not in Anki!) and run `yanki ./your-deck-folder` again.

#### Delete

Delete the Markdown file locally (not in Anki!) and run `yanki ./your-deck-folder` again.

### CLI

All available commands and options for advanced use cases are described below, but shouldn't typically be necessary.

<!-- cli-help -->

#### Command: `yanki`

Run a Yanki command. Defaults to `sync` if a command is not provided.

This section lists top-level commands for `yanki`.

If no command is provided, `yanki sync` is run by default.

Usage:

```txt
yanki [command]
```

| Command  | Argument                  | Description                                                                                                                                                                                                                              |
| -------- | ------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `sync`   | `<directory>` `[options]` | Perform a one-way synchronization from a local directory of Markdown files to the Anki database. Any Markdown files in subdirectories are included as well. _(Default command.)_                                                         |
| `list`   |                           | Utility command to list Yanki-created notes in the Anki database.                                                                                                                                                                        |
| `delete` |                           | Utility command to manually delete Yanki-created notes in the Anki database. This is for advanced use cases, usually the `sync` command takes care of deleting files from Anki Database once they're removed from the local file system. |

_See the sections below for more information on each subcommand._

#### Subcommand: `yanki sync`

Perform a one-way synchronization from a local directory of Markdown files to the Anki database. Any Markdown files in subdirectories are included as well.

Usage:

```txt
yanki sync <directory> [options]
```

| Positional Argument | Description                                                              | Type     |
| ------------------- | ------------------------------------------------------------------------ | -------- |
| `directory`         | The path to the local directory of Markdown files to sync. _(Required.)_ | `string` |

| Option               | Alias | Description                                                                                                                     | Type      | Default                   |
| -------------------- | ----- | ------------------------------------------------------------------------------------------------------------------------------- | --------- | ------------------------- |
| `--dry-run`          | `-d`  | Run without making any changes to the Anki database. See a report of what would have been done.                                 | `boolean` | `false`                   |
| `--namespace`        | `-n`  | Advanced option for managing multiple Yanki synchronization groups. Case insensitive. See the readme for more information.      | `string`  | "Yanki CLI"               |
| `--anki-connect`     |       | Host and port of the Anki-Connect server. The default is usually fine. See the Anki-Connect documentation for more information. | `string`  | `"http://127.0.0.1:8765"` |
| `--anki-auto-launch` |       | Attempt to open the desktop Anki.app if it's not already running. (Experimental, macOS only.)                                   | `boolean` | `false`                   |
| `--json`             |       | Output the sync report as JSON.                                                                                                 | `boolean` | `false`                   |
| `--verbose`          |       | Enable verbose logging.                                                                                                         | `boolean` | `false`                   |
| `--help`             | `-h`  | Show help                                                                                                                       | `boolean` |                           |
| `--version`          | `-v`  | Show version number                                                                                                             | `boolean` |                           |

#### Subcommand: `yanki list`

Utility command to list Yanki-created notes in the Anki database.

Usage:

```txt
yanki list
```

| Option               | Alias | Description                                                                                                                                                                                                | Type      | Default                   |
| -------------------- | ----- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------- | ------------------------- |
| `--namespace`        | `-n`  | Advanced option to list notes in a specific namespace. Case insensitive. Notes from the default internal namespace are listed by default. Pass `'*'` to list all Yanki-created notes in the Anki database. | `string`  | "Yanki CLI"               |
| `--anki-connect`     |       | Host and port of the Anki-Connect server. The default is usually fine. See the Anki-Connect documentation for more information.                                                                            | `string`  | `"http://127.0.0.1:8765"` |
| `--anki-auto-launch` |       | Attempt to open the desktop Anki.app if it's not already running. (Experimental, macOS only.)                                                                                                              | `boolean` | `false`                   |
| `--json`             |       | Output the list of notes as JSON to stdout.                                                                                                                                                                | `boolean` | `false`                   |
| `--help`             | `-h`  | Show help                                                                                                                                                                                                  | `boolean` |                           |
| `--version`          | `-v`  | Show version number                                                                                                                                                                                        | `boolean` |                           |

#### Subcommand: `yanki delete`

Utility command to manually delete Yanki-created notes in the Anki database. This is for advanced use cases, usually the `sync` command takes care of deleting files from Anki Database once they're removed from the local file system.

Usage:

```txt
yanki delete
```

| Option               | Alias | Description                                                                                                                                                                                                  | Type      | Default                   |
| -------------------- | ----- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | --------- | ------------------------- |
| `--dry-run`          | `-d`  | Run without making any changes to the Anki database. See a report of what would have been done.                                                                                                              | `boolean` | `false`                   |
| `--namespace`        | `-n`  | Advanced option to list notes in a specific namespace. Case insensitive. Notes from the default internal namespace are listed by default. Pass `'*'` to delete all Yanki-created notes in the Anki database. | `string`  | "Yanki CLI"               |
| `--anki-connect`     |       | Host and port of the Anki-Connect server. The default is usually fine. See the Anki-Connect documentation for more information.                                                                              | `string`  | `"http://127.0.0.1:8765"` |
| `--anki-auto-launch` |       | Attempt to open the desktop Anki.app if it's not already running. (Experimental, macOS only.)                                                                                                                | `boolean` | `false`                   |
| `--json`             |       | Output the list of deleted notes as JSON to stdout.                                                                                                                                                          | `boolean` | `false`                   |
| `--verbose`          |       | Enable verbose logging.                                                                                                                                                                                      | `boolean` | `false`                   |
| `--help`             | `-h`  | Show help                                                                                                                                                                                                    | `boolean` |                           |
| `--version`          | `-v`  | Show version number                                                                                                                                                                                          | `boolean` |                           |

<!-- /cli-help -->

### Library

#### API

This package also exposes an API for integrating syncing capability programmatically in other context. (For example, in [yanki-obsidian](https://github.com/kitschpatrol/yanki-obsidian).)

The following functions are exported:

```ts
syncFiles(allLocalFilePaths: string[], options?: Partial<SyncOptions>): Promise<SyncReport>

getNoteFromMarkdown(markdown: string, namespace: string): Promise<YankiNote>

syncNotes(allLocalNotes: YankiNote[], options?: Partial<SyncOptions>): Promise<SyncReport>

listNotes(options?: ListOptions): Promise<ListReport>

cleanNotes(options: CleanOptions): Promise<CleanReport>
```

See the source code for additional inline documentation.

## Background

### Motivation

### Implementation notes

The excellent [unified](https://unifiedjs.com) / [remark](https://remark.js.org) / mdast libraries are used extensively to traverse and render the underlying Markdown ASTs.

[Anki-Connect](https://foosoft.net/projects/anki-connect/) provides access to Anki's database.

For type safety, access to Anki-Connect is managed through my wrapper library, [yanki-connect](https://github.com/kitschpatrol/yanki-connect).

Behind the scenes, Yanki MD creates new note type models to match the four default Anki types. It keeps track of the notes it has ownership of via a hidden `YankiNamespace` field in each note.

### Other projects

- Luke Murray's [markdown-anki-decks](https://github.com/lukesmurray/markdown-anki-decks)
- Oleksandr Shlinchak's [mdanki](https://github.com/ashlinchak/mdanki).
- Ben Weinstein-Raun's [ankidown](https://github.com/ankicommunity/ankidown/)
- Alex Biosa's [Markdown2Anki](https://github.com/Mochitto/Markdown2Anki)

## The future

Either embedding media assets or implementing integration with Anki's media library could be helpful for offline study. (Though externally hosted image links seem generally fine for now.)

## Maintainers

[@kitschpatrol](https://github.com/kitschpatrol)

## Acknowledgements

Thanks to Alex Yatskov for creating [Anki-Connect](https://foosoft.net/projects/anki-connect/).

<!-- contributing -->

## Contributing

[Issues](https://github.com/kitschpatrol/yanki-md/issues) and pull requests are welcome.

<!-- /contributing -->

<!-- license -->

## License

[MIT](license.txt) © Eric Mika

<!-- /license -->
